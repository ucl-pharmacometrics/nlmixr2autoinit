% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/getnca.R
\name{best_slope}
\alias{best_slope}
\title{Estimate terminal elimination rate constant (Lambda Z)}
\usage{
best_slope(
  time,
  conc,
  route = "bolus",
  adj_r_squared_threshold = 0.7,
  nlastpoints = 3,
  tolerance = 1e-04
)
}
\arguments{
\item{time}{Numeric vector of observation time points.}

\item{conc}{Numeric vector of concentration measurements corresponding to time points.}

\item{route}{Administration method specification:
\itemize{
\item "bolus" (default) - Excludes time of maximum concentration (Tmax) point
\item "infusion" - Includes Tmax point in terminal phase evaluation
}}

\item{adj_r_squared_threshold}{Minimum acceptable adjusted R-squared value for valid
estimation (default = 0.7). Values below this threshold will generate warnings.}

\item{tolerance}{Threshold for considering adjusted R-squared values statistically
equivalent (default = 1e-4). Used when selecting between fits with similar goodness-of-fit.}
}
\value{
A list containing:
\itemize{
\item \code{Lamdaz}: Estimated terminal elimination rate constant (λ_z), or NA if no valid fit
\item \code{UsedPoints}: Number of data points used in the optimal fit
\item \code{adj.r.squared}: Adjusted R-squared value of the optimal regression
\item \code{message}: Character vector containing diagnostic messages/warnings
}
}
\description{
Identifies the optimal terminal phase for lambda-z estimation using a systematic
log-linear regression approach with adjusted R-squared optimization criteria.
}
\details{
The algorithm implements the following decision logic:
\enumerate{
\item Identifies the time of maximum observed concentration (Tmax)
\item Defines candidate terminal phases starting from the last 3 measurable concentrations
\item Iteratively evaluates longer time spans by including preceding data points
\item For each candidate phase:
\itemize{
\item Performs log-concentration vs. time linear regression
\item Requires negative regression slope (positive λ_z)
\item Calculates adjusted R-squared metric
}
\item Selects the optimal phase based on:
\itemize{
\item Highest adjusted R-squared value
\item When R-squared differences are < tolerance, selects the fit with more points
}
\item Validates final selection against R-squared threshold
}
}
\examples{
# Basic usage
time <- c(0.5, 1, 2, 4, 6, 8, 10)
conc <- c(12, 8, 5, 3, 2, 1.5, 1)
result <- best_slope(time, conc)

# With infusion route specification
result_infusion <- best_slope(time, conc, route = "infusion")

# Custom threshold settings
result_custom <- best_slope(time, conc, adj_r_squared_threshold = 0.8, tolerance = 0.001)

}
