% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_single_point_base.R
\name{calculate_vd}
\alias{calculate_vd}
\title{Estimate volume of distribution (Vd) from concentration Data}
\usage{
calculate_vd(
  dat,
  half_life = NULL,
  dose_type = NULL,
  pooled_ctrl = pooled_control(),
  route = c("bolus", "oral", "infusion")
)
}
\arguments{
\item{dat}{A data frame containing pharmacokinetic data. Must include at least the following columns:
\code{EVID}, \code{dose_number}, \code{tad}, \code{iiobs}, \code{TIME}, \code{DV}, and optionally \code{durationobs} and \code{rateobs}
for infusion routes.}

\item{half_life}{Optional numeric value for the elimination half-life. If NULL, it will be estimated
using the \code{get_hf()} function based on pooled data.}

\item{dose_type}{Character value indicating the dose type, required if \code{half_life} is NULL. Used
internally during half-life estimation.}

\item{pooled_ctrl}{An optional list of control parameters used by \code{get_pooled_data()} for pooling
observations. Defaults to output from \code{pooled_control()}.}

\item{route}{Character string specifying the route of administration. Must be one of \code{"bolus"},
\code{"oral"}, or \code{"infusion"}. Currently, \code{"oral"} is not implemented.}
}
\value{
A named list with two components:
\describe{
\item{vd_df}{A \code{data.frame} of selected observations with an added \code{vd} column representing
the calculated volume of distribution for each subject.}
\item{trimmed_mean_vd}{A numeric value giving the trimmed geometric mean of individual Vd estimates,
using a 5\% trimming level to reduce the impact of outliers.}
}
}
\description{
Calculates the volume of distribution (Vd) for either intravenous bolus or infusion routes
using a adaptive single-point method. If half-life is not provided, it can be estimated using pooled data.
}
\details{
The function uses an early concentration point (based on time since dosing and half-life)
to estimate Vd. For bolus:
\deqn{Vd = \frac{\text{Dose}}{C_0}}
For infusion:
\deqn{Vd = \frac{\text{Rate} \times \min(\text{TIME}, \text{durationobs})}{C}}
where \code{C} is the observed concentration (\code{DV}).

When \code{half_life} is not provided, it is estimated from pooled data using
\code{get_pooled_data()} and \code{get_hf()}.
}
\examples{
\dontrun{
# Bolus example
dat <- Bolus_1CPT
out <- processData(dat)
fdat<- out$dat
froute <-out$Datainfo$Value[out$Datainfo$Infometrics == "Dose Route"]
half_life <- get_hf(dat = fdat)$half_life_median
calculate_vd(dat = fdat, half_life = half_life,route=froute)

# Infusion example
dat <- Infusion_1CPT
out <- processData(dat)
fdat<- out$dat
froute <-out$Datainfo$Value[out$Datainfo$Infometrics == "Dose Route"]
half_life <- get_hf(dat = fdat)$half_life_median
calculate_vd(dat = fdat, half_life = half_life,route=froute)

}
}
