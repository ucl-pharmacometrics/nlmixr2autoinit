% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_pooled_nca.R
\name{run_pooled_nca}
\alias{run_pooled_nca}
\title{Perform Non-Compartmental Analysis (NCA) on Pooled Pharmacokinetic Data
Performs non-compartmental analysis (NCA) using pooled pharmacokinetic data
for various dosing scenarios, including first dose, repeated doses, or a combined
analysis of both.}
\usage{
run_pooled_nca(
  dat,
  route = c("bolus", "oral", "infusion"),
  dose_type = c("first_dose", "repeated_doses", "combined_doses"),
  pooled = NULL,
  pooled_ctrl = pooled_control(),
  nca_ctrl = nca_control()
)
}
\arguments{
\item{dat}{A data frame containing pharmacokinetic data. Required columns depend on
the specified \code{dose_type} (see Details).}

\item{route}{Character string indicating the administration route.
One of \code{"bolus"}, \code{"oral"}, or \code{"infusion"}.}

\item{dose_type}{Type of analysis to perform. One of:
\itemize{
\item{\code{"first_dose"}}: First-dose analysis (default)
\item{\code{"repeated_doses"}}: Analysis of doses beyond the first (e.g., steady-state)
\item{\code{"combined_doses"}}: Analysis combining first and repeated doses
}}

\item{pooled}{(Optional) A precomputed pooled data list as returned by \code{\link{get_pooled_data}}.
This must be a list that may contain one or more of the following named elements:
\describe{
\item{\code{datpooled_fd}}{Binned data for first-dose analysis (output of \code{bin.time})}
\item{\code{datpooled_efd}}{Binned data for repeated-dose analysis}
\item{\code{datpooled_all}}{Binned data combining first and repeated doses}
}
If not supplied, the function will compute pooled data automatically.}

\item{pooled_ctrl}{A list of control options created by \code{\link{pooled_control}}.
Controls time binning and data preprocessing during pooled analysis.
\describe{
\item{\code{nbins}}{Number of bins to use when binning data.}
\item{\code{bin_method}}{Method used for time binning. One of:
\code{"quantile"}, \code{"jenks"}, \code{"kmeans"}, \code{"pretty"}, \code{"sd"}, \code{"equal"}, or \code{"density"}.}
\item{\code{tad_rounding}}{Logical. If TRUE (default), both \code{tad} and the most common dosing interval
are rounded to the nearest whole unit before comparing. This allows for
small deviations (e.g., a \code{tad} of 24.3 is treated as within a 24-unit interval).}
}}

\item{nca_ctrl}{A list of NCA control settings created by \code{\link{nca_control}}.
Controls numerical integration, slope estimation, and regression point selection for NCA.
\describe{
\item{\code{trapezoidal_rule}}{Specifies the trapezoidal integration method:
\code{"linear"} or \code{"linear_up_log_down"} (default).}
\item{\code{nlastpoints}}{Number of terminal points used in half-life regression (default = 3).}
\item{\code{slope.method}}{Method for estimating terminal slope (\eqn{\lambda_z}): \code{"bestfit"} or
\code{"bestfitforce"} (default).}
}}
}
\value{
A named list containing:
\itemize{
\item{\code{nca.fd.results}}: NCA results for first-dose data (if applicable)
\item{\code{nca.efd.results}}: NCA results for repeated doses (if applicable)
\item{\code{nca.all.results}}: NCA results for combined first and repeated doses (if applicable)
}
Any result not relevant to the \code{dose_type} will return \code{NA}.
}
\description{
Perform Non-Compartmental Analysis (NCA) on Pooled Pharmacokinetic Data
Performs non-compartmental analysis (NCA) using pooled pharmacokinetic data
for various dosing scenarios, including first dose, repeated doses, or a combined
analysis of both.
}
\details{
This function supports flexible NCA workflows where pooled data can either be computed
internally using \code{\link{get_pooled_data}}, or supplied externally (e.g., reused across calls).
Required columns in \code{dat} are automatically checked within \code{get_pooled_data}.

For infusion analyses (\code{route = "infusion"}), the representative infusion duration is determined
based on observation records (\code{EVID == 0}). Each sampling time point is associated with a corresponding
infusion duration, recorded in the \code{durationobs} column. This value reflects the infusion responsible
for the observed concentration at that time. When estimating a pooled duration (e.g., for lambda-z estimation),
the most commonly used value in \code{durationobs} is selected to ensure consistency with the analyzed profile.
}
\examples{
\dontrun{

# Example 1: Pre-pooling externally using get_pooled_data()
dat <- Bolus_1CPT[Bolus_1CPT$SD == 1, ]
out <- processData(dat)
fdat<- out$dat
froute <-out$Datainfo$Value[out$Datainfo$Infometrics == "Dose Route"]
pooled <- get_pooled_data(fdat, dose_type = "first_dose")
run_pooled_nca(dat, dose_type = "first_dose", route=froute, pooled = pooled)

# Example 2: Automatic pooling within run_pooled_nca()
dat <- Bolus_1CPT
out <- processData(dat)
fdat<- out$dat
froute <-out$Datainfo$Value[out$Datainfo$Infometrics == "Dose Route"]
pooled <- get_pooled_data(dat, dose_type = "first_dose")
run_pooled_nca(fdat, dose_type = "combined_doses", route=froute)


# Example 3: Infusion case
dat <- Infusion_1CPT
out <- processData(dat)
fdat<- out$dat
froute <-out$Datainfo$Value[out$Datainfo$Infometrics == "Dose Route"]
fdosetype<-out$Datainfo$Value[out$Datainfo$Infometrics == "Dose Type"]
pooled <- get_pooled_data(fdat, dose_type = fdosetype)
run_pooled_nca(fdat, dose_type = fdosetype, route=froute)

}

}
\seealso{
\code{\link{get_pooled_data}}, \code{\link{bin.time}}, \code{\link{getnca}}
}
